<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake World</title>
<style>
body{margin:0;overflow:hidden;background:#111;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© ===== */
const worldSize=3000;   // Ø­Ø¬Ù… Ø§Ù„Ø¹Ø§Ù„Ù…
const wallColor="red";

/* ===== Ø§Ù„Ø­ÙŠØ© ===== */
let snake=[];
let length=40;
let speed=2;
let angle=0;

let headStart={x:worldSize/2,y:worldSize/2};
for(let i=0;i<length;i++){
    snake.push({x:headStart.x,y:headStart.y});
}

/* ===== Ø§Ù„ÙÙˆØ§ÙƒÙ‡ ===== */
const fruits=["ğŸ","ğŸŒ","ğŸ‡","ğŸ“","ğŸ‰"];
let foods=[];
for(let i=0;i<100;i++){
    foods.push({
        x:Math.random()*worldSize,
        y:Math.random()*worldSize,
        icon:fruits[Math.floor(Math.random()*fruits.length)]
    });
}

/* ===== ØªØ­ÙƒÙ… Ù„Ù…Ø³ ===== */
let touchX=canvas.width/2;
let touchY=canvas.height/2;

canvas.addEventListener("touchmove",e=>{
    const rect=canvas.getBoundingClientRect();
    touchX=e.touches[0].clientX-rect.left;
    touchY=e.touches[0].clientY-rect.top;
});

/* ===== Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø±Ø¨Ø¹Ø© ===== */
function drawGrid(camX,camY){
    ctx.strokeStyle="#222";
    ctx.lineWidth=1;
    const gridSize=80;

    for(let x=-camX%gridSize;x<canvas.width;x+=gridSize){
        ctx.beginPath();
        ctx.moveTo(x,0);
        ctx.lineTo(x,canvas.height);
        ctx.stroke();
    }

    for(let y=-camY%gridSize;y<canvas.height;y+=gridSize){
        ctx.beginPath();
        ctx.moveTo(0,y);
        ctx.lineTo(canvas.width,y);
        ctx.stroke();
    }
}

/* ===== Ø§Ù„Ù„Ø¹Ø¨Ø© ===== */
function draw(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ÙƒØ§Ù…ÙŠØ±Ø§ ØªØªØ¨Ø¹ Ø§Ù„Ø±Ø£Ø³
    let camX=snake[0].x-canvas.width/2;
    let camY=snake[0].y-canvas.height/2;

    drawGrid(camX,camY);

    ctx.save();
    ctx.translate(-camX,-camY);

    /* Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø£Ø­Ù…Ø± */
    ctx.strokeStyle=wallColor;
    ctx.lineWidth=20;
    ctx.strokeRect(0,0,worldSize,worldSize);

    /* Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ© */
    let dx=touchX-canvas.width/2;
    let dy=touchY-canvas.height/2;
    angle=Math.atan2(dy,dx);

    /* ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø±Ø£Ø³ */
    let head={
        x:snake[0].x+Math.cos(angle)*speed,
        y:snake[0].y+Math.sin(angle)*speed
    };

    // Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø¯Ø§Ø±
    if(head.x<20||head.y<20||head.x>worldSize-20||head.y>worldSize-20){
        alert("Ø§ØµØ·Ø¯Ù…Øª Ø¨Ø§Ù„Ø¬Ø¯Ø§Ø±!");
        location.reload();
    }

    snake.unshift(head);
    if(snake.length>length) snake.pop();

    /* Ø±Ø³Ù… Ø§Ù„ÙÙˆØ§ÙƒÙ‡ */
    ctx.font="30px Arial";
    for(let i=0;i<foods.length;i++){
        ctx.fillText(foods[i].icon,foods[i].x-15,foods[i].y+10);

        let dist=Math.hypot(head.x-foods[i].x,head.y-foods[i].y);
        if(dist<25){
            length+=8;
            foods[i].x=Math.random()*worldSize;
            foods[i].y=Math.random()*worldSize;
            foods[i].icon=fruits[Math.floor(Math.random()*fruits.length)];
        }
    }

    /* Ø±Ø³Ù… Ø¬Ø³Ù… Ø§Ù„Ø­ÙŠØ© */
    for(let i=snake.length-1;i>=0;i--){
        ctx.beginPath();
        ctx.fillStyle=i===0?"#ffffff":"#00ff88";
        ctx.arc(snake[i].x,snake[i].y,12,0,Math.PI*2);
        ctx.fill();
    }

    /* Ø±Ø³Ù… Ø§Ù„Ø¹ÙŠÙˆÙ† */
    ctx.fillStyle="black";
    let eyeOffsetX=Math.cos(angle)*8;
    let eyeOffsetY=Math.sin(angle)*8;

    ctx.beginPath();
    ctx.arc(head.x+eyeOffsetX-5,head.y+eyeOffsetY-5,3,0,Math.PI*2);
    ctx.arc(head.x+eyeOffsetX+5,head.y+eyeOffsetY+5,3,0,Math.PI*2);
    ctx.fill();

    /* Ø±Ø³Ù… Ø§Ù„ÙÙ… */
    ctx.strokeStyle="black";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(head.x,head.y,6,angle+0.5,angle-0.5,true);
    ctx.stroke();

    ctx.restore();

    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
