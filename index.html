<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Worm Snake Game - Professional Mode</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #121212; font-family: sans-serif; touch-action: none; }
        canvas { display: block; background-image: radial-gradient(#2a2a2a 1px, transparent 1px); background-size: 30px 30px; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; z-index: 10; }
        .stat { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 20px; margin-bottom: 5px; border: 1px solid #444; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat" id="score">النقاط: 0</div>
    <div class="stat" id="rank">الترتيب: #1</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let mouse = { x: canvas.width / 2, y: canvas.height / 2, pressed: false };
let score = 0;

class Snake {
    constructor(x, y, color, isPlayer) {
        this.segments = [];
        for(let i=0; i<25; i++) this.segments.push({x, y});
        this.color = color;
        this.radius = 18;
        this.angle = Math.random() * Math.PI * 2;
        this.speed = 3.5;
        this.isPlayer = isPlayer;
        this.maxLength = 25;
        this.isDead = false;
    }

    draw() {
        if(this.isDead) return;

        // رسم الجسم المخطط بتدرج ألوان سلس مثل الصورة
        for (let i = this.segments.length - 1; i >= 0; i--) {
            ctx.beginPath();
            // تبديل اللون كل قطعتين لإنشاء نمط مخطط
            ctx.fillStyle = (Math.floor(i/3) % 2 === 0) ? this.color : "#ffffff";
            ctx.globalAlpha = 1 - (i / this.segments.length * 0.5); // تدرج شفافية
            
            // جعل الذيل أنحف تدريجياً
            let size = this.radius * (1 - i / (this.segments.length * 2));
            ctx.arc(this.segments[i].x, this.segments[i].y, size, 0, Math.PI * 2);
            ctx.fill();
        }

        // رسم الرأس: العيون والفم مرسومة برمجياً لتطابق الصورة
        let head = this.segments[0];
        ctx.save();
        ctx.globalAlpha = 1;
        ctx.translate(head.x, head.y);
        ctx.rotate(this.angle);

        // بياض العين الكبير (مرسوم برمجياً بشكل بيضاوي)
        ctx.fillStyle = "white";
        ctx.beginPath(); ctx.ellipse(12, -12, 11, 10, 0, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(12, 12, 11, 10, 0, 0, Math.PI*2); ctx.fill();
        
        // بؤبؤ العين الأسود (يتحرك مع اتجاه الحركة)
        ctx.fillStyle = "black";
        ctx.beginPath(); ctx.arc(16, -12, 5, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(16, 12, 5, 0, Math.PI*2); ctx.fill();
        
        // رسم الفم (الخط الأسود المقوس مثل الصورة)
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2.5;
        ctx.beginPath();
        // إنشاء قوس بسيط يمثل الابتسامة الواقعية
        ctx.arc(5, 0, 10, Math.PI*1.2, Math.PI*0.8);
        ctx.stroke();

        ctx.restore();
    }

    update() {
        if(this.isDead) return;
        let head = { ...this.segments[0] };
        
        // نظام السرعة (Boost)
        let curSpeed = (this.isPlayer && mouse.pressed && this.segments.length > 20) ? this.speed * 2 : this.speed;
        if (this.isPlayer && mouse.pressed && this.segments.length > 20 && Math.random() > 0.8) {
            let lastSeg = this.segments.pop();
            food.push({x: lastSeg.x, y: lastSeg.y, color: this.color, r: 8});
            this.maxLength = this.segments.length;
        }

        if (this.isPlayer) {
            let targetAngle = Math.atan2(mouse.y - head.y, mouse.x - head.x);
            let diff = targetAngle - this.angle;
            while (diff < -Math.PI) diff += Math.PI * 2;
            while (diff > Math.PI) diff -= Math.PI * 2;
            this.angle += diff * 0.1;
        } else {
            // ذكاء اصطناعي بسيط للبوتات
            if (Math.random() < 0.02) this.angle += (Math.random() - 0.5) * 2;
        }

        head.x += Math.cos(this.angle) * curSpeed;
        head.y += Math.sin(this.angle) * curSpeed;

        this.segments.unshift(head);
        if (this.segments.length > this.maxLength) this.segments.pop();

        // حدود الشاشة
        if (head.x < 0 || head.x > canvas.width || head.y < 0 || head.y > canvas.height) this.die();
    }

    die() {
        this.isDead = true;
        // تحويل الثعبان لطعام عند الموت
        this.segments.forEach(s => {
            food.push({x: s.x, y: s.y, color: this.color, r: 10});
        });
        if(this.isPlayer) setTimeout(startNewGame, 1500);
    }
}

// ألوان متبادلة مثل الصورة
let player = new Snake(canvas.width/2, canvas.height/2, "#4CAF50", true);
let enemies = [
    new Snake(800, 800, "#F44336", false),
    new Snake(1500, 1000, "#2196F3", false),
    new Snake(1000, 2500, "#FFEB3B", false),
    new Snake(500, 1800, "#9C27B0", false)
];
let food = [];

function startNewGame() {
    score = 0;
    document.getElementById('score').innerText = `النقاط: 0`;
    player = new Snake(canvas.width/2, canvas.height/2, "#4CAF50", true);
    enemies = [
        new Snake(800, 800, "#F44336", false),
        new Snake(1500, 1000, "#2196F3", false),
        new Snake(1000, 2500, "#FFEB3B", false)
    ];
    food = [];
}

function spawnFood() {
    if(food.length < 150) {
        food.push({
            x: Math.random()*canvas.width,
            y: Math.random()*canvas.height,
            color: `hsl(${Math.random()*360}, 100%, 60%)`,
            r: 7
        });
    }
}

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    spawnFood();

    // رسم الطعام
    food.forEach((f, index) => {
        ctx.beginPath(); ctx.fillStyle = f.color;
        ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
        
        let dist = Math.hypot(player.segments[0].x - f.x, player.segments[0].y - f.y);
        if(dist < 30) {
            food.splice(index, 1);
            player.maxLength += 3;
            score += 10;
            document.getElementById('score').innerText = `النقاط: ${score}`;
        }
    });

    // تحديث الكل وفحص التصادم
    [player, ...enemies].forEach(s => {
        if(!s.isDead) {
            s.update();
            s.draw();
            
            // تصادم الرأس بالجسم
            [player, ...enemies].forEach(other => {
                if(s !== other && !other.isDead) {
                    other.segments.forEach(seg => {
                        if(Math.hypot(s.segments[0].x - seg.x, s.segments[0].y - seg.y) < 20) s.die();
                    });
                }
            });
        }
    });

    requestAnimationFrame(animate);
}

// التحكم
const updateMouse = (e) => {
    mouse.x = e.clientX || e.touches[0].clientX;
    mouse.y = e.clientY || e.touches[0].clientY;
};
window.addEventListener('mousemove', updateMouse);
window.addEventListener('touchmove', updateMouse);
window.addEventListener('mousedown', () => mouse.pressed = true);
window.addEventListener('mouseup', () => mouse.pressed = false);
window.addEventListener('touchstart', (e) => { mouse.pressed = true; updateMouse(e); });
window.addEventListener('touchend', () => mouse.pressed = false);

startNewGame();
animate();
</script>
</body>
</html>
