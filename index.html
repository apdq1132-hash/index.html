<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake World Pro</title>
<style>
body{margin:0;overflow:hidden;background:#111;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
const worldSize=3000;
const wallSize=20;
const fruitsIcons=["ğŸ","ğŸŒ","ğŸ‡","ğŸ“","ğŸ‰"];
let snake, length, speed, angle, foods, touchX, touchY;

/* Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© */
function startGame(){
    snake=[];
    length=40;
    speed=2;
    angle=0;

    let startX=worldSize/2;
    let startY=worldSize/2;

    for(let i=0;i<length;i++){
        snake.push({x:startX,y:startY});
    }

    foods=[];
    for(let i=0;i<120;i++){
        foods.push({
            x:Math.random()*worldSize,
            y:Math.random()*worldSize,
            icon:fruitsIcons[Math.floor(Math.random()*fruitsIcons.length)]
        });
    }
}
startGame();

/* ØªØ­ÙƒÙ… Ù„Ù…Ø³ */
touchX=canvas.width/2;
touchY=canvas.height/2;

canvas.addEventListener("touchmove",e=>{
    const rect=canvas.getBoundingClientRect();
    touchX=e.touches[0].clientX-rect.left;
    touchY=e.touches[0].clientY-rect.top;
});

/* Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø±Ø¨Ø¹Ø© */
function drawGrid(camX,camY){
    ctx.strokeStyle="#222";
    ctx.lineWidth=1;
    const grid=80;

    for(let x=-camX%grid;x<canvas.width;x+=grid){
        ctx.beginPath();
        ctx.moveTo(x,0);
        ctx.lineTo(x,canvas.height);
        ctx.stroke();
    }

    for(let y=-camY%grid;y<canvas.height;y+=grid){
        ctx.beginPath();
        ctx.moveTo(0,y);
        ctx.lineTo(canvas.width,y);
        ctx.stroke();
    }
}

/* Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
function draw(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    let camX=snake[0].x-canvas.width/2;
    let camY=snake[0].y-canvas.height/2;

    drawGrid(camX,camY);

    ctx.save();
    ctx.translate(-camX,-camY);

    /* Ø§Ù„Ø¬Ø¯Ø§Ø± */
    ctx.strokeStyle="red";
    ctx.lineWidth=wallSize;
    ctx.strokeRect(0,0,worldSize,worldSize);

    /* Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø±ÙƒØ© */
    let dx=touchX-canvas.width/2;
    let dy=touchY-canvas.height/2;
    angle=Math.atan2(dy,dx);

    /* ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø±Ø£Ø³ */
    let head={
        x:snake[0].x+Math.cos(angle)*speed,
        y:snake[0].y+Math.sin(angle)*speed
    };

    /* Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø¯Ø§Ø± */
    if(
        head.x<wallSize ||
        head.y<wallSize ||
        head.x>worldSize-wallSize ||
        head.y>worldSize-wallSize
    ){
        alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!");
        startGame();   // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„ØµÙØ±
        return;
    }

    snake.unshift(head);
    if(snake.length>length) snake.pop();

    /* Ø±Ø³Ù… Ø§Ù„ÙÙˆØ§ÙƒÙ‡ */
    ctx.font="30px Arial";
    for(let i=0;i<foods.length;i++){
        ctx.fillText(foods[i].icon,foods[i].x-15,foods[i].y+10);

        let dist=Math.hypot(head.x-foods[i].x,head.y-foods[i].y);
        if(dist<25){
            length+=8;
            foods[i].x=Math.random()*worldSize;
            foods[i].y=Math.random()*worldSize;
            foods[i].icon=fruitsIcons[Math.floor(Math.random()*fruitsIcons.length)];
        }
    }

    /* Ø±Ø³Ù… Ø§Ù„Ø¬Ø³Ù… */
    for(let i=snake.length-1;i>0;i--){
        ctx.beginPath();
        ctx.fillStyle="#00ff88";
        ctx.arc(snake[i].x,snake[i].y,12,0,Math.PI*2);
        ctx.fill();
    }

    /* ===== Ø±Ø³Ù… Ø§Ù„Ø±Ø£Ø³ ===== */
    let r=14;
    ctx.beginPath();
    ctx.fillStyle="white";
    ctx.arc(head.x,head.y,r,0,Math.PI*2);
    ctx.fill();

    /* Ø§Ù„Ø¹ÙŠÙˆÙ† */
    let eyeDist=8;
    let perpAngle=angle+Math.PI/2;

    let eye1x=head.x + Math.cos(angle)*5 + Math.cos(perpAngle)*5;
    let eye1y=head.y + Math.sin(angle)*5 + Math.sin(perpAngle)*5;

    let eye2x=head.x + Math.cos(angle)*5 - Math.cos(perpAngle)*5;
    let eye2y=head.y + Math.sin(angle)*5 - Math.sin(perpAngle)*5;

    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(eye1x,eye1y,3,0,Math.PI*2);
    ctx.arc(eye2x,eye2y,3,0,Math.PI*2);
    ctx.fill();

    /* Ø§Ù„ÙÙ… */
    ctx.strokeStyle="black";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(
        head.x + Math.cos(angle)*4,
        head.y + Math.sin(angle)*4,
        6,
        angle+0.4,
        angle-0.4,
        true
    );
    ctx.stroke();

    ctx.restore();

    requestAnimationFrame(draw);
}

draw();

</script>
</body>
</html>
